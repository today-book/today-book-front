<script>
  const params = new URLSearchParams(window.location.search);
  const authCode = params.get('authCode');

  async function login(authCode) {
    try {
      const response = await fetch(
          'https://dev-api.todaybook.life/api/v1/auth/login',
          {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            credentials: 'include',
            body: JSON.stringify({ authCode })
          }
      );

      if (!response.ok) {
        throw new Error('Login failed');
      }

      const data = await response.json();

      // accessToken만 저장
      localStorage.setItem('accessToken', data.accessToken);

      // refreshToken은 서버가 HttpOnly Cookie로 설정함

      // 로그인 성공 후 이동
      location.replace('/today-book-front');
    } catch (e) {
      console.error(e);
      alert('로그인에 실패했습니다.');
      location.replace('/today-book-front?login=failed');
    }
  }

  if (authCode) {
    login(authCode);
  } else {
    alert('로그인에 실패했습니다.');
    location.replace('/today-book-front?login=failed');
  }
</script>
